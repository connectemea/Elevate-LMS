generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Participant {
  id            String             @id @default(uuid())
  name          String
  year          Int
  email         String?            @unique
  createdAt     DateTime           @default(now())
  enrollments   CourseEnrollment[]
  sessionStatus SessionProgress[]

  @@index([year])
}

model Course {
  id          String             @id @default(uuid())
  name        String
  description String?
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  categories  CourseCategory[]
  enrollments CourseEnrollment[]
}

model CourseCategory {
  id         String     @id @default(uuid())
  courseId   String
  name       String
  orderIndex Int
  createdAt  DateTime   @default(now())
  course     Course     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  sessions   Session[]

  @@index([courseId, orderIndex])
}

model Session {
  id          String     @id @default(uuid())
  categoryId  String
  title       String
  assetLink   String
  assetType   AssetType
  orderIndex  Int
  createdAt   DateTime   @default(now())
  category    CourseCategory @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  progress    SessionProgress[]

  @@index([categoryId, orderIndex])
}

model CourseEnrollment {
  id             String     @id @default(uuid())
  participantId  String
  courseId       String
  progress       Float?     @default(0)
  enrolledAt     DateTime   @default(now())
  participant    Participant @relation(fields: [participantId], references: [id], onDelete: Cascade)
  course         Course      @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([participantId, courseId])
}

model SessionProgress {
  id            String     @id @default(uuid())
  sessionId     String
  participantId String
  status        SessionStatus
  updatedAt     DateTime   @default(now())
  session       Session     @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  participant   Participant @relation(fields: [participantId], references: [id], onDelete: Cascade)

  @@unique([sessionId, participantId])
}

enum AssetType {
  youtube
  web
  pdf
  other
}

enum SessionStatus {
  in_progress
  completed
}